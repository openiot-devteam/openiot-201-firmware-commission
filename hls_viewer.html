<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HLS 스트림 뷰어</title>
  <style>
    body { margin:0; padding:24px; font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:#111; color:#eee; }
    .wrap { max-width: 960px; margin: 0 auto; }
    h1 { margin: 0 0 16px; font-size: 20px; }
    .grid { display:grid; gap:12px; }
    video { width: 100%; max-height: 75vh; background:#000; border-radius:12px; outline:none; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap: wrap; }
    input[type="text"] { flex: 1 1 480px; padding:10px 12px; border-radius:8px; border:1px solid #333; background:#1a1a1a; color:#eee; }
    button { padding:10px 14px; border-radius:8px; border:0; background:#3a86ff; color:#fff; cursor:pointer; }
    button.secondary { background:#444; }
    .hint { color:#aaa; font-size: 13px; }
    .err { color:#ff7a7a; white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>HLS 스트림 뷰어</h1>

    <div class="grid">
      <div class="row">
        <input id="url" type="text" placeholder="http://<서버IP>:8090/index.m3u8" />
        <button id="play">재생</button>
        <button id="save" class="secondary">URL 저장</button>
      </div>
      <video id="player" controls autoplay muted playsinline></video>
      <div class="hint">
        - PC/안드로이드: Hls.js 사용<br/>
        - iOS/Safari: 네이티브 HLS 자동 재생
      </div>
      <div class="err" id="error"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const input = document.getElementById('url');
    const playBtn = document.getElementById('play');
    const saveBtn = document.getElementById('save');
    const video = document.getElementById('player');
    const errorBox = document.getElementById('error');

    function guessDefaultUrl() {
      try {
        const loc = window.location;
        const host = loc.hostname || 'localhost';
        return `http://${host}:8090/index.m3u8`;
      } catch { return 'http://localhost:8090/index.m3u8'; }
    }

    function showError(e){
      console.error(e);
      errorBox.textContent = `[재생 오류] ${e && e.message ? e.message : e}`;
    }

    function play(url){
      try {
        errorBox.textContent = '';
        if (window.hls) { try { window.hls.destroy(); } catch {} }
        if (window.Hls && Hls.isSupported()) {
          const hls = new Hls({ maxBufferLength: 10, liveSyncDurationCount: 3 });
          window.hls = hls;
          hls.loadSource(url);
          hls.attachMedia(video);
          hls.on(Hls.Events.ERROR, (_, data) => {
            if (data && data.fatal) showError(`Hls.js fatal: ${data.type}/${data.details}`);
          });
          hls.on(Hls.Events.MANIFEST_PARSED, () => video.play().catch(showError));
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = url;
          video.addEventListener('loadedmetadata', () => video.play().catch(showError), { once:true });
        } else {
          showError('HLS를 지원하지 않는 브라우저입니다. 다른 브라우저를 사용해 주세요.');
        }
      } catch (e) { showError(e); }
    }

    playBtn.addEventListener('click', () => {
      const url = input.value.trim();
      if (!url) return showError('URL을 입력하세요.');
      play(url);
    });
    saveBtn.addEventListener('click', () => {
      const url = input.value.trim();
      if (!url) return;
      try { localStorage.setItem('HLS_URL', url); } catch {}
    });

    // 초기화
    (function init(){
      let url = '';
      try { url = localStorage.getItem('HLS_URL') || ''; } catch {}
      if (!url) url = guessDefaultUrl();
      input.value = url;
      play(url);
    })();
  </script>
</body>
</html>


